{"ast":null,"code":"import axios from 'axios';\nconst AUTO_UPLOAD_URL = 'http://localhost:3001/api/v1/auto-upload/';\n\n// Function to load the encryption key\nconst loadEncryptionKey = async () => {\n  try {\n    const response = await fetch('/encryption_key.txt');\n    const key = await response.text();\n    return key;\n  } catch (error) {\n    console.error('Error loading encryption key:', error);\n    throw error;\n  }\n};\n\n// Function to encrypt the API key\nconst encryptApiKey = async apiKey => {\n  const encryptionKey = await loadEncryptionKey();\n  const encoder = new TextEncoder();\n  const data = encoder.encode(apiKey);\n  const key = await crypto.subtle.importKey('raw', encoder.encode(encryptionKey), {\n    name: 'AES-GCM'\n  }, false, ['encrypt']);\n  const iv = crypto.getRandomValues(new Uint8Array(12));\n  const encrypted = await crypto.subtle.encrypt({\n    name: 'AES-GCM',\n    iv: iv\n  }, key, data);\n  const encryptedArray = new Uint8Array(encrypted);\n  return btoa(String.fromCharCode.apply(null, [...iv, ...encryptedArray]));\n};\nexport const handleAutoUpload = async () => {\n  try {\n    const apiKey = localStorage.getItem('apiKey');\n    if (!apiKey) {\n      console.error('No API key found in localStorage');\n      // Handle this case - maybe redirect to login\n      return;\n    }\n    const encryptedApiKey = await encryptApiKey(apiKey);\n    const response = await axios.post(AUTO_UPLOAD_URL, {}, {\n      headers: {\n        'Authorization': `EncryptedKey ${encryptedApiKey}`\n      }\n    });\n    console.log('Auto-upload response:', response.data);\n    return response.data;\n  } catch (error) {\n    console.error('Error during auto-upload:', error);\n    throw error;\n  }\n};\nexport const startAutoUploadInterval = intervalInMinutes => {\n  const intervalInMilliseconds = intervalInMinutes * 60 * 1000;\n  const intervalId = setInterval(async () => {\n    try {\n      await handleAutoUpload();\n    } catch (error) {\n      console.error('Error in auto-upload interval:', error);\n    }\n  }, intervalInMilliseconds);\n  return intervalId;\n};\nexport const stopAutoUploadInterval = intervalId => {\n  clearInterval(intervalId);\n};","map":{"version":3,"names":["axios","AUTO_UPLOAD_URL","loadEncryptionKey","response","fetch","key","text","error","console","encryptApiKey","apiKey","encryptionKey","encoder","TextEncoder","data","encode","crypto","subtle","importKey","name","iv","getRandomValues","Uint8Array","encrypted","encrypt","encryptedArray","btoa","String","fromCharCode","apply","handleAutoUpload","localStorage","getItem","encryptedApiKey","post","headers","log","startAutoUploadInterval","intervalInMinutes","intervalInMilliseconds","intervalId","setInterval","stopAutoUploadInterval","clearInterval"],"sources":["C:/Users/AMX1/Downloads/Repo/OAD_Auto/ous_agile_devops_ai/oad_ai/oad_ai_frontend/src/AutoUploadManager.js"],"sourcesContent":["import axios from 'axios';\r\n\r\nconst AUTO_UPLOAD_URL = 'http://localhost:3001/api/v1/auto-upload/';\r\n\r\n// Function to load the encryption key\r\nconst loadEncryptionKey = async () => {\r\n  try {\r\n    const response = await fetch('/encryption_key.txt');\r\n    const key = await response.text();\r\n    return key;\r\n  } catch (error) {\r\n    console.error('Error loading encryption key:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n// Function to encrypt the API key\r\nconst encryptApiKey = async (apiKey) => {\r\n  const encryptionKey = await loadEncryptionKey();\r\n  const encoder = new TextEncoder();\r\n  const data = encoder.encode(apiKey);\r\n  const key = await crypto.subtle.importKey(\r\n    'raw',\r\n    encoder.encode(encryptionKey),\r\n    { name: 'AES-GCM' },\r\n    false,\r\n    ['encrypt']\r\n  );\r\n  const iv = crypto.getRandomValues(new Uint8Array(12));\r\n  const encrypted = await crypto.subtle.encrypt(\r\n    { name: 'AES-GCM', iv: iv },\r\n    key,\r\n    data\r\n  );\r\n  const encryptedArray = new Uint8Array(encrypted);\r\n  return btoa(String.fromCharCode.apply(null, [...iv, ...encryptedArray]));\r\n};\r\n\r\nexport const handleAutoUpload = async () => {\r\n  try {\r\n    const apiKey = localStorage.getItem('apiKey');\r\n    if (!apiKey) {\r\n      console.error('No API key found in localStorage');\r\n      // Handle this case - maybe redirect to login\r\n      return;\r\n    }\r\n\r\n    const encryptedApiKey = await encryptApiKey(apiKey);\r\n\r\n    const response = await axios.post(AUTO_UPLOAD_URL, {}, {\r\n      headers: {\r\n        'Authorization': `EncryptedKey ${encryptedApiKey}`,\r\n      },\r\n    });\r\n\r\n    console.log('Auto-upload response:', response.data);\r\n    return response.data;\r\n  } catch (error) {\r\n    console.error('Error during auto-upload:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nexport const startAutoUploadInterval = (intervalInMinutes) => {\r\n  const intervalInMilliseconds = intervalInMinutes * 60 * 1000;\r\n\r\n  const intervalId = setInterval(async () => {\r\n    try {\r\n      await handleAutoUpload();\r\n    } catch (error) {\r\n      console.error('Error in auto-upload interval:', error);\r\n    }\r\n  }, intervalInMilliseconds);\r\n\r\n  return intervalId;\r\n};\r\n\r\nexport const stopAutoUploadInterval = (intervalId) => {\r\n  clearInterval(intervalId);\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}